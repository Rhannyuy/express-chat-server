<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Chat Room</title>
	<script
  src="http://code.jquery.com/jquery-3.1.1.js"
  integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
  crossorigin="anonymous"></script>
</head>
<body>
   <h1>Chat Server</h1>
   
   <a href="/">Change User</a>
    <p>Username:</p><span id="username"></span>
	<input type="text" id="input">
	<button id="send">Send</button>
	<div id="output"></div>
	<script>

		function getMessages(){
			$.get("/chat", function(res){
				console.log(res);
				// res ---> '["chats cleared", "a", "b"]'
				/* res ---> '[{
				 text: "hi",
				 user: "erty",
				 date: 9873456234
				}]'
				*/
				var arrObj = JSON.parse(res);
				// msgs = ["chats cleared", "a", "b"]
				$('#output').empty();
				for (obj of arrObj) {
					var newPara = $('<p></p>');
					newPara.text(obj.username + ":" + obj.message  + ":" + obj.date); // text, not HTML
					$('#output').append(newPara);
				}
			})
		}

		function userName(){
			$.get("/username", function(res){
				console.log(res);
				// res ---> '["chats cleared", "a", "b"]'
				var username = JSON.parse(res);
				// msgs = ["chats cleared", "a", "b"]
				$('#username').text(username)
			})
		}

		function sendMessage(){
			var msg = $('#input').val();
			$('#input').val(""); // empty string -> clear input
			$.post("/chat", {
				message: msg,
				date: Date.now()
			}, function(res) {
				getMessages();
			});
		}

		$('#send').click(sendMessage);

		$('#input').keyup(function(event) {
			if (event.keyCode === 13) {
				// 13 is "enter" / "return"
				sendMessage();
			}
		});

		$(document).ready(function(){
			getMessages();
			userName()
			setInterval(getMessages, 1000);
		});
</script>
	
</body>
</html>